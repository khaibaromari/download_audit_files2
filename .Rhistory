library(httr)
library(jsonlite)
library(dplyr)
library(tibble)
# Kobo user and password
pass    <- Sys.getenv("KOBO_PSW")
user    <- Sys.getenv("KOBO_USR")
# Get list of v1 api urls for all deployed forms.
forms_list <-
GET("https://kc.humanitarianresponse.info/api/v1/data/948276",
authenticate(user, pass), timeout(1000)) %>%
content(., "text", encoding = "UTF-8")
library(httr)
library(jsonlite)
library(dplyr)
library(tibble)
# Kobo user and password
pass    <- Sys.getenv("KOBO_PSW")
user    <- Sys.getenv("KOBO_USR")
# Get list of v1 api urls for all deployed forms.
forms_list <-
GET("https://kc.humanitarianresponse.info/api/v1/data/948276",
authenticate(user, pass), timeout(1000)) %>%
content(., "text", encoding = "UTF-8")
library(httr)
library(jsonlite)
library(dplyr)
library(tibble)
# Kobo user and password
pass    <- Sys.getenv("KOBO_PSW")
user    <- Sys.getenv("KOBO_USR")
# Get list of v1 api urls for all deployed forms.
forms_list <-
GET("https://kc.humanitarianresponse.info/api/v1/data/948276",
authenticate(user, pass), timeout(1000)) %>%
content(., "text", encoding = "UTF-8")
library(httr)
library(jsonlite)
library(dplyr)
library(tibble)
# Kobo user and password
pass    <- Sys.getenv("KOBO_PSW")
user    <- Sys.getenv("KOBO_USR")
# Get list of v1 api urls for all deployed forms.
forms_list <-
GET("https://kc.humanitarianresponse.info/api/v1/data/948276",
authenticate(user, pass), timeout(1000)) %>%
content(., "text", encoding = "UTF-8") %>%
fromJSON()
library(httr)
library(jsonlite)
library(dplyr)
library(tibble)
# Kobo user and password
pass    <- Sys.getenv("KOBO_PSW")
user    <- Sys.getenv("KOBO_USR")
# Get list of v1 api urls for all deployed forms.
forms_list <-
GET("https://kc.humanitarianresponse.info/api/v1/data/948276",
authenticate(user, pass), timeout(1000)) %>%
content(., "text", encoding = "UTF-8") %>%
fromJSON(., flatten = T)
library(httr)
library(jsonlite)
library(dplyr)
library(tibble)
# Kobo user and password
pass    <- Sys.getenv("KOBO_PSW")
user    <- Sys.getenv("KOBO_USR")
# Get list of v1 api urls for all deployed forms.
forms_list <-
GET("https://kc.humanitarianresponse.info/api/v1/data/948276",
authenticate(user, pass), timeout(1000))
library(httr)
library(jsonlite)
library(dplyr)
library(tibble)
# Kobo user and password
pass    <- Sys.getenv("KOBO_PSW")
user    <- Sys.getenv("KOBO_USR")
# Get list of v1 api urls for all deployed forms.
forms_list <-
GET("https://kc.humanitarianresponse.info/api/v1/data/948276",
authenticate(user, pass), timeout(1000)) %>%
content(., "text", encoding = "UTF-8") %>%
fromJSON(., flatten = T)
forms_list$_attachments
forms_list[["_attachments"]]
forms_list[["_attachments"]]["download_url"]
forms_list[["_attachments"]][["download_url"]]
attachment_url <- forms_list[["_attachments"]]
str(attachment_url)
attachment_url[1]
attachment_url[[1]]
attachment_url[[1]][1]
unlist(attachment_url)
unlist(attachment_url)[1]
unlist(attachment_url)[ c(TRUE,FALSE, FALSE, FALSE, FALSE, FALSE) ]
unlist(attachment_url)[ c(TRUE,FALSE, FALSE, FALSE, FALSE, FALSE, FALSE) ]
unlist(attachment_url)[ c(TRUE,FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE) ]
names(unlist(attachment_url))
names(unlist(attachment_url)) == "download_url"
unlist(attachment_url)[names(unlist(attachment_url)) == "download_url"]
unlist(attachment_url)[names(unlist(attachment_url)) == "download_url"] %>% unname
library(httr)
library(jsonlite)
library(dplyr)
library(tibble)
# Kobo user and password
pass    <- Sys.getenv("KOBO_PSW")
user    <- Sys.getenv("KOBO_USR")
# Get list of v1 api urls for all deployed forms.
forms_list <-
GET("https://kc.humanitarianresponse.info/api/v1/data/948276",
authenticate(user, pass), timeout(1000)) %>%
content(., "text", encoding = "UTF-8") %>%
fromJSON(., flatten = T) %>%
select(`_attachments`)
unlist(attachment_url)[names(unlist(attachment_url)) == "download_url"] %>% unname
unlist(forms_list)[names(unlist(forms_list)) == "download_url"] %>% unname
forms_list
library(httr)
library(jsonlite)
library(dplyr)
library(tibble)
# Kobo user and password
pass    <- Sys.getenv("KOBO_PSW")
user    <- Sys.getenv("KOBO_USR")
# Get list of v1 api urls for all deployed forms.
forms_list <-
GET("https://kc.humanitarianresponse.info/api/v1/data/948276",
authenticate(user, pass), timeout(1000)) %>%
content(., "text", encoding = "UTF-8") %>%
fromJSON(., flatten = T)
attachment_url <- forms_list[["_attachments"]]
attachment_url
library(httr)
library(dplyr)
library(jsonlite)
form_name <- "ameM9v8nctyy8MRHMJfRX7"
output_dir <- "output/audit_files/"
user <- Sys.getenv("KOBO_USR")
pass <- Sys.getenv("KOBO_PSW")
form_list <- GET("https://kc.humanitarianresponse.info/api/v1/data/",
authenticate(user, pass), timeout(1000)) %>%
content(., "text", encoding = "UTF-8") %>%
fromJSON(., flatten = T)
form_list <- GET("https://kc.humanitarianresponse.info/api/v1/data",
authenticate(user, pass), timeout(1000)) %>%
content(., "text", encoding = "UTF-8") %>%
fromJSON(., flatten = T)
View(form_list)
form_url <- GET("https://kc.humanitarianresponse.info/api/v1/data",
authenticate(user, pass), timeout(1000)) %>%
content(., "text", encoding = "UTF-8") %>%
fromJSON(., flatten = T) %>%
filter(id_string == form_name) %>%
select(url) %>%
unlist
library(httr)
library(dplyr)
library(jsonlite)
form_name <- "ameM9v8nctyy8MRHMJfRX7"
output_dir <- "output/audit_files/"
user <- Sys.getenv("KOBO_USR")
pass <- Sys.getenv("KOBO_PSW")
form_url <- GET("https://kc.humanitarianresponse.info/api/v1/data", authenticate(user, pass), timeout(1000)) %>%
content(., "text", encoding = "UTF-8") %>%
fromJSON(., flatten = T) %>%
filter(id_string == form_name) %>%
select(url) %>%
unlist
form_data <- GET(form_url, authenticate(user, pass), timeout(1000)) %>%
content(., "text", encoding = "UTF-8") %>%
fromJSON(., flatten = T)
attachment_url <- forms_list[["_attachments"]]
unlist(forms_list)[names(unlist(forms_list)) == "download_url"] %>% unname()
library(httr)
library(dplyr)
library(jsonlite)
form_name <- "ameM9v8nctyy8MRHMJfRX7"
output_dir <- "output/audit_files/"
user <- Sys.getenv("KOBO_USR")
pass <- Sys.getenv("KOBO_PSW")
form_url <- GET("https://kc.humanitarianresponse.info/api/v1/data", authenticate(user, pass), timeout(1000)) %>%
content(., "text", encoding = "UTF-8") %>%
fromJSON(., flatten = T) %>%
filter(id_string == form_name) %>%
select(url) %>%
unlist
form_data <- GET(form_url, authenticate(user, pass), timeout(1000)) %>%
content(., "text", encoding = "UTF-8") %>%
fromJSON(., flatten = T)
attachment_url <- form_data[["_attachments"]]
unlist(form_data)[names(unlist(form_data)) == "download_url"] %>% unname()
library(httr)
library(dplyr)
library(jsonlite)
form_name <- "ameM9v8nctyy8MRHMJfRX7"
output_dir <- "output/audit_files/"
user <- Sys.getenv("KOBO_USR")
pass <- Sys.getenv("KOBO_PSW")
form_url <- GET("https://kc.humanitarianresponse.info/api/v1/data", authenticate(user, pass), timeout(1000)) %>%
content(., "text", encoding = "UTF-8") %>%
fromJSON(., flatten = T) %>%
filter(id_string == form_name) %>%
select(url) %>%
unlist
form_url
form_data <- GET(form_url, authenticate(user, pass), timeout(1000)) %>%
content(., "text", encoding = "UTF-8") %>%
fromJSON(., flatten = T)
attachment_url <- form_data[["_attachments"]]
attachment_url
unlist(attachment_url)[names(unlist(attachment_url)) == "download_url"] %>% unname()
library(httr)
library(dplyr)
library(jsonlite)
form_name <- "ameM9v8nctyy8MRHMJfRX7"
output_dir <- "output/audit_files/"
user <- Sys.getenv("KOBO_USR")
pass <- Sys.getenv("KOBO_PSW")
form_url <- GET("https://kc.humanitarianresponse.info/api/v1/data", authenticate(user, pass), timeout(1000)) %>%
content(., "text", encoding = "UTF-8") %>%
fromJSON(., flatten = T) %>%
filter(id_string == form_name) %>%
select(url) %>%
unlist()
form_data <- GET(form_url, authenticate(user, pass), timeout(1000)) %>%
content(., "text", encoding = "UTF-8") %>%
fromJSON(., flatten = T) %>%
select(`_attachments`)
form_data
flatten(form_data)
form_data <- GET(form_url, authenticate(user, pass), timeout(1000)) %>%
content(., "text", encoding = "UTF-8") %>%
fromJSON(., flatten = T) %>%
flatten()
form_data
str(form_data)
tail(str(form_data))
form_data <- GET(form_url, authenticate(user, pass), timeout(1000)) %>%
content(., "text", encoding = "UTF-8") %>%
fromJSON(., flatten = T) %>%
flatten() %>%
as_data_frame() %>%
mutate(attachments = as.character("_attachments")) %>%
select(attachments)
View(form_data)
form_data <- GET(form_url, authenticate(user, pass), timeout(1000)) %>%
content(., "text", encoding = "UTF-8") %>%
fromJSON(., flatten = T) %>%
flatten() %>%
as_data_frame() %>%
mutate(attachments = as.character(`_attachments`)) %>%
select(attachments)
View(form_data)
form_data <- GET(form_url, authenticate(user, pass), timeout(1000)) %>%
content(., "text", encoding = "UTF-8") %>%
fromJSON(., flatten = T) %>%
flatten() %>%
as_data_frame() %>%
mutate(attachments = as.character(`_attachments`)) %>%
select(attachments) %>%
unlist()
form_data
form_data <- GET(form_url, authenticate(user, pass), timeout(1000)) %>%
content(., "text", encoding = "UTF-8") %>%
fromJSON(., flatten = T) %>%
flatten() %>%
as_data_frame() %>%
mutate(attachments = as.character(`_attachments`)) %>%
select(attachments)
unlist(attachment_url)[names(unlist(attachment_url)) == "download_url"] %>% unname()
unlist(form_data)[names(unlist(form_data)) == "download_url"] %>% unname()
library(httr)
library(dplyr)
library(jsonlite)
form_name <- "ameM9v8nctyy8MRHMJfRX7"
output_dir <- "output/audit_files/"
user <- Sys.getenv("KOBO_USR")
pass <- Sys.getenv("KOBO_PSW")
form_url <- GET("https://kc.humanitarianresponse.info/api/v1/data", authenticate(user, pass), timeout(1000)) %>%
content(., "text", encoding = "UTF-8") %>%
fromJSON(., flatten = T) %>%
filter(id_string == form_name) %>%
select(url) %>%
unlist()
form_data <- GET(form_url, authenticate(user, pass), timeout(1000)) %>%
content(., "text", encoding = "UTF-8") %>%
fromJSON(., flatten = T)
attachment_url <- form_data[["_attachments"]]
unlist(form_data)[names(unlist(form_data)) == "download_url"] %>% unname()
unlist(attachment_url)[names(unlist(attachment_url)) == "download_url"] %>% unname()
form_data$`_uuid`
library(httr)
library(dplyr)
library(jsonlite)
form_name <- "ameM9v8nctyy8MRHMJfRX7"
output_dir <- "output/audit_files/"
user <- Sys.getenv("KOBO_USR")
pass <- Sys.getenv("KOBO_PSW")
form_url <- GET("https://kc.humanitarianresponse.info/api/v1/data", authenticate(user, pass), timeout(1000)) %>%
content(., "text", encoding = "UTF-8") %>%
fromJSON(., flatten = T) %>%
filter(id_string == form_name) %>%
select(url) %>%
unlist()
form_data <- GET(form_url, authenticate(user, pass), timeout(1000)) %>%
content(., "text", encoding = "UTF-8") %>%
fromJSON(., flatten = T) %>%
as.data.frame()
attachment_url <- form_data[["_attachments"]]
unlist(attachment_url)[names(unlist(attachment_url)) == "download_url"] %>% unname()
available_audits <- dir("input/audit_files/")
library(httr)
library(dplyr)
library(jsonlite)
form_name <- "ameM9v8nctyy8MRHMJfRX7"
output_dir <- "output/audit_files/"
user <- Sys.getenv("KOBO_USR")
pass <- Sys.getenv("KOBO_PSW")
available_audits <- dir("input/audit_files/")
# getting form url
form_url <- GET("https://kc.humanitarianresponse.info/api/v1/data", authenticate(user, pass), timeout(1000)) %>%
content(., "text", encoding = "UTF-8") %>%
fromJSON(., flatten = T) %>%
filter(id_string == form_name) %>%
select(url) %>%
unlist()
# getting attachment links of uuids that their audit is already downloaded
form_data <- GET(form_url, authenticate(user, pass), timeout(1000)) %>%
content(., "text", encoding = "UTF-8") %>%
fromJSON(., flatten = T) %>%
as.data.frame() %>%
filter(!`_uuid` %in% available_audits)
attachment_url <- form_data[["_attachments"]]
unlist(attachment_url)[names(unlist(attachment_url)) == "download_url"] %>% unname()
output_dir
